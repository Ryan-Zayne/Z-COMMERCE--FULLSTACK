var ut=e=>{throw TypeError(e)};var K=(e,t,i)=>t.has(e)||ut("Cannot "+i);var s=(e,t,i)=>(K(e,t,"read from private field"),i?i.call(e):t.get(e)),u=(e,t,i)=>t.has(e)?ut("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),h=(e,t,i,a)=>(K(e,t,"write to private field"),a?a.call(e,i):t.set(e,i),i),o=(e,t,i)=>(K(e,t,"access private method"),i);import{y as yt,ak as lt,al as R,am as N,an as B,ao as Ct,aj as dt,ap as ft,aq as St,ar as Ot,as as It,at as pt,z as Tt,r as j}from"./index-CtoIyiXC.js";var b,r,P,f,O,F,g,y,L,Q,w,I,T,C,U,n,M,$,G,J,X,Y,Z,q,Rt,mt,Pt=(mt=class extends yt{constructor(t,i){super();u(this,n);u(this,b);u(this,r);u(this,P);u(this,f);u(this,O);u(this,F);u(this,g);u(this,y);u(this,L);u(this,Q);u(this,w);u(this,I);u(this,T);u(this,C);u(this,U,new Set);this.options=i,h(this,b,t),h(this,y,null),h(this,g,lt()),this.options.experimental_prefetchInRender||s(this,g).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(i)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(s(this,r).addObserver(this),bt(s(this,r),this.options)?o(this,n,M).call(this):this.updateResult(),o(this,n,X).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return tt(s(this,r),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return tt(s(this,r),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,o(this,n,Y).call(this),o(this,n,Z).call(this),s(this,r).removeObserver(this)}setOptions(t){const i=this.options,a=s(this,r);if(this.options=s(this,b).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof R(this.options.enabled,s(this,r))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");o(this,n,q).call(this),s(this,r).setOptions(this.options),i._defaulted&&!N(this.options,i)&&s(this,b).getQueryCache().notify({type:"observerOptionsUpdated",query:s(this,r),observer:this});const l=this.hasListeners();l&&vt(s(this,r),a,this.options,i)&&o(this,n,M).call(this),this.updateResult(),l&&(s(this,r)!==a||R(this.options.enabled,s(this,r))!==R(i.enabled,s(this,r))||B(this.options.staleTime,s(this,r))!==B(i.staleTime,s(this,r)))&&o(this,n,$).call(this);const c=o(this,n,G).call(this);l&&(s(this,r)!==a||R(this.options.enabled,s(this,r))!==R(i.enabled,s(this,r))||c!==s(this,C))&&o(this,n,J).call(this,c)}getOptimisticResult(t){const i=s(this,b).getQueryCache().build(s(this,b),t),a=this.createResult(i,t);return xt(this,a)&&(h(this,f,a),h(this,F,this.options),h(this,O,s(this,r).state)),a}getCurrentResult(){return s(this,f)}trackResult(t,i){const a={};return Object.keys(t).forEach(l=>{Object.defineProperty(a,l,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(l),i==null||i(l),t[l])})}),a}trackProp(t){s(this,U).add(t)}getCurrentQuery(){return s(this,r)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const i=s(this,b).defaultQueryOptions(t),a=s(this,b).getQueryCache().build(s(this,b),i);return a.fetch().then(()=>this.createResult(a,i))}fetch(t){return o(this,n,M).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),s(this,f)))}createResult(t,i){var ct;const a=s(this,r),l=this.options,c=s(this,f),E=s(this,O),D=s(this,F),z=t!==a?t.state:s(this,P),{state:st}=t;let d={...st},it=!1,p;if(i._optimisticResults){const v=this.hasListeners(),_=!v&&bt(t,i),x=v&&vt(t,a,i,l);(_||x)&&(d={...d,...It(st.data,t.options)}),i._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:rt,errorUpdatedAt:at,status:S}=d;p=d.data;let nt=!1;if(i.placeholderData!==void 0&&p===void 0&&S==="pending"){let v;c!=null&&c.isPlaceholderData&&i.placeholderData===(D==null?void 0:D.placeholderData)?(v=c.data,nt=!0):v=typeof i.placeholderData=="function"?i.placeholderData((ct=s(this,w))==null?void 0:ct.state.data,s(this,w)):i.placeholderData,v!==void 0&&(S="success",p=pt(c==null?void 0:c.data,v,i),it=!0)}if(i.select&&p!==void 0&&!nt)if(c&&p===(E==null?void 0:E.data)&&i.select===s(this,L))p=s(this,Q);else try{h(this,L,i.select),p=i.select(p),p=pt(c==null?void 0:c.data,p,i),h(this,Q,p),h(this,y,null)}catch(v){h(this,y,v)}s(this,y)&&(rt=s(this,y),p=s(this,Q),at=Date.now(),S="error");const H=d.fetchStatus==="fetching",V=S==="pending",W=S==="error",ht=V&&H,ot=p!==void 0,m={status:S,fetchStatus:d.fetchStatus,isPending:V,isSuccess:S==="success",isError:W,isInitialLoading:ht,isLoading:ht,data:p,dataUpdatedAt:d.dataUpdatedAt,error:rt,errorUpdatedAt:at,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>z.dataUpdateCount||d.errorUpdateCount>z.errorUpdateCount,isFetching:H,isRefetching:H&&!V,isLoadingError:W&&!ot,isPaused:d.fetchStatus==="paused",isPlaceholderData:it,isRefetchError:W&&ot,isStale:et(t,i),refetch:this.refetch,promise:s(this,g)};if(this.options.experimental_prefetchInRender){const v=A=>{m.status==="error"?A.reject(m.error):m.data!==void 0&&A.resolve(m.data)},_=()=>{const A=h(this,g,m.promise=lt());v(A)},x=s(this,g);switch(x.status){case"pending":t.queryHash===a.queryHash&&v(x);break;case"fulfilled":(m.status==="error"||m.data!==x.value)&&_();break;case"rejected":(m.status!=="error"||m.error!==x.reason)&&_();break}}return m}updateResult(){const t=s(this,f),i=this.createResult(s(this,r),this.options);if(h(this,O,s(this,r).state),h(this,F,this.options),s(this,O).data!==void 0&&h(this,w,s(this,r)),N(i,t))return;h(this,f,i);const a=()=>{if(!t)return!0;const{notifyOnChangeProps:l}=this.options,c=typeof l=="function"?l():l;if(c==="all"||!c&&!s(this,U).size)return!0;const E=new Set(c??s(this,U));return this.options.throwOnError&&E.add("error"),Object.keys(s(this,f)).some(D=>{const k=D;return s(this,f)[k]!==t[k]&&E.has(k)})};o(this,n,Rt).call(this,{listeners:a()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&o(this,n,X).call(this)}},b=new WeakMap,r=new WeakMap,P=new WeakMap,f=new WeakMap,O=new WeakMap,F=new WeakMap,g=new WeakMap,y=new WeakMap,L=new WeakMap,Q=new WeakMap,w=new WeakMap,I=new WeakMap,T=new WeakMap,C=new WeakMap,U=new WeakMap,n=new WeakSet,M=function(t){o(this,n,q).call(this);let i=s(this,r).fetch(this.options,t);return t!=null&&t.throwOnError||(i=i.catch(Ct)),i},$=function(){o(this,n,Y).call(this);const t=B(this.options.staleTime,s(this,r));if(dt||s(this,f).isStale||!ft(t))return;const a=St(s(this,f).dataUpdatedAt,t)+1;h(this,I,setTimeout(()=>{s(this,f).isStale||this.updateResult()},a))},G=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(s(this,r)):this.options.refetchInterval)??!1},J=function(t){o(this,n,Z).call(this),h(this,C,t),!(dt||R(this.options.enabled,s(this,r))===!1||!ft(s(this,C))||s(this,C)===0)&&h(this,T,setInterval(()=>{(this.options.refetchIntervalInBackground||Ot.isFocused())&&o(this,n,M).call(this)},s(this,C)))},X=function(){o(this,n,$).call(this),o(this,n,J).call(this,o(this,n,G).call(this))},Y=function(){s(this,I)&&(clearTimeout(s(this,I)),h(this,I,void 0))},Z=function(){s(this,T)&&(clearInterval(s(this,T)),h(this,T,void 0))},q=function(){const t=s(this,b).getQueryCache().build(s(this,b),this.options);if(t===s(this,r))return;const i=s(this,r);h(this,r,t),h(this,P,t.state),this.hasListeners()&&(i==null||i.removeObserver(this),t.addObserver(this))},Rt=function(t){Tt.batch(()=>{t.listeners&&this.listeners.forEach(i=>{i(s(this,f))}),s(this,b).getQueryCache().notify({query:s(this,r),type:"observerResultsUpdated"})})},mt);function Et(e,t){return R(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function bt(e,t){return Et(e,t)||e.state.data!==void 0&&tt(e,t,t.refetchOnMount)}function tt(e,t,i){if(R(t.enabled,e)!==!1){const a=typeof i=="function"?i(e):i;return a==="always"||a!==!1&&et(e,t)}return!1}function vt(e,t,i,a){return(e!==t||R(a.enabled,e)===!1)&&(!i.suspense||e.state.status!=="error")&&et(e,i)}function et(e,t){return R(t.enabled,e)!==!1&&e.isStaleByTime(B(t.staleTime,e))}function xt(e,t){return!N(e.getCurrentResult(),t)}var gt=j.createContext(!1),Lt=()=>j.useContext(gt);gt.Provider;function Ft(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Qt=j.createContext(Ft()),jt=()=>j.useContext(Qt);function wt(e,t){return typeof e=="function"?e(...t):!!e}function kt(){}var _t=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},At=e=>{j.useEffect(()=>{e.clearReset()},[e])},Bt=({result:e,errorResetBoundary:t,throwOnError:i,query:a,suspense:l})=>e.isError&&!t.isReset()&&!e.isFetching&&a&&(l&&e.data===void 0||wt(i,[e.error,a])),zt=e=>{const t=e.staleTime;e.suspense&&(e.staleTime=typeof t=="function"?(...i)=>Math.max(t(...i),1e3):Math.max(t??1e3,1e3),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3)))},Ht=(e,t)=>e.isLoading&&e.isFetching&&!t,Vt=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,Wt=(e,t,i)=>t.fetchOptimistic(e).catch(()=>{i.clearReset()});export{Pt as Q,jt as a,_t as b,At as c,zt as e,Wt as f,Bt as g,kt as n,Vt as s,Lt as u,Ht as w};
