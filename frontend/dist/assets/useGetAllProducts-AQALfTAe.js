import{b as e,c as t,d as n,e as r,f as i,g as a,h as o,i as s,j as c,k as l}from"./suspense-CFbDoGTd.js";import{I as u,K as d,R as f,S as p,X as m,ao as h,ax as g,e as _,f as v}from"./index-Bp9otwrI.js";function y(e,t){let n=new Set(t);return e.filter(e=>!n.has(e))}function b(e,t,n){let r=e.slice(0);return r[t]=n,r}var x=class extends m{#client;#result;#queries;#options;#observers;#combinedResult;#lastCombine;#lastResult;#observerMatches=[];constructor(e,t,n){super(),this.#client=e,this.#options=n,this.#queries=[],this.#observers=[],this.#result=[],this.setQueries(t)}onSubscribe(){this.listeners.size===1&&this.#observers.forEach(e=>{e.subscribe(t=>{this.#onUpdate(e,t)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#observers.forEach(e=>{e.destroy()})}setQueries(e,t){this.#queries=e,this.#options=t,d.batch(()=>{let e=this.#observers,t=this.#findMatchingObservers(this.#queries);this.#observerMatches=t,t.forEach(e=>e.observer.setOptions(e.defaultedQueryOptions));let n=t.map(e=>e.observer),r=n.map(e=>e.getCurrentResult()),i=n.some((t,n)=>t!==e[n]);e.length===n.length&&!i||(this.#observers=n,this.#result=r,this.hasListeners()&&(y(e,n).forEach(e=>{e.destroy()}),y(n,e).forEach(e=>{e.subscribe(t=>{this.#onUpdate(e,t)})}),this.#notify()))})}getCurrentResult(){return this.#result}getQueries(){return this.#observers.map(e=>e.getCurrentQuery())}getObservers(){return this.#observers}getOptimisticResult(e,t){let n=this.#findMatchingObservers(e),r=n.map(e=>e.observer.getOptimisticResult(e.defaultedQueryOptions));return[r,e=>this.#combineResult(e??r,t),()=>this.#trackResult(r,n)]}#trackResult(e,t){return t.map((n,r)=>{let i=e[r];return n.defaultedQueryOptions.notifyOnChangeProps?i:n.observer.trackResult(i,e=>{t.forEach(t=>{t.observer.trackProp(e)})})})}#combineResult(e,t){return t?((!this.#combinedResult||this.#result!==this.#lastResult||t!==this.#lastCombine)&&(this.#lastCombine=t,this.#lastResult=this.#result,this.#combinedResult=p(this.#combinedResult,t(e))),this.#combinedResult):e}#findMatchingObservers(e){let t=new Map(this.#observers.map(e=>[e.options.queryHash,e])),n=[];return e.forEach(e=>{let r=this.#client.defaultQueryOptions(e),i=t.get(r.queryHash);i?n.push({defaultedQueryOptions:r,observer:i}):n.push({defaultedQueryOptions:r,observer:new l(this.#client,r)})}),n}#onUpdate(e,t){let n=this.#observers.indexOf(e);n!==-1&&(this.#result=b(this.#result,n,t),this.#notify())}#notify(){if(this.hasListeners()){let e=this.#combinedResult,t=this.#trackResult(this.#result,this.#observerMatches),n=this.#combineResult(t,this.#options?.combine);e!==n&&d.batch(()=>{this.listeners.forEach(e=>{e(this.#result)})})}}},S=g(h());function C({queries:p,...m},h){let g=u(h),_=c(),v=s(),y=S.useMemo(()=>p.map(e=>{let t=g.defaultQueryOptions(e);return t._optimisticResults=_?`isRestoring`:`optimistic`,t}),[p,g,_]);y.forEach(e=>{t(e),o(e,v)}),a(v);let[b]=S.useState(()=>new x(g,y,m)),[C,w,T]=b.getOptimisticResult(y,m.combine),E=!_&&m.subscribed!==!1;S.useSyncExternalStore(S.useCallback(e=>E?b.subscribe(d.batchCalls(e)):f,[b,E]),()=>b.getCurrentResult(),()=>b.getCurrentResult()),S.useEffect(()=>{b.setQueries(y,m)},[y,m,b]);let D=C.some((e,t)=>r(y[t],e)),O=D?C.flatMap((t,i)=>{let a=y[i];if(a){let i=new l(g,a);if(r(a,t))return n(a,i,v);e(t,_)&&n(a,i,v)}return[]}):[];if(O.length>0)throw Promise.all(O);let k=C.find((e,t)=>{let n=y[t];return n&&i({result:e,errorResetBoundary:v,throwOnError:n.throwOnError,query:g.getQueryCache().get(n.queryHash),suspense:n.suspense})});if(k?.error)throw k.error;return w(T())}const w=()=>{let{data:e,isError:t,isPending:n}=C({combine:e=>({data:e.flatMap(e=>e.data),isError:e.some(e=>e.isError),isPending:e.some(e=>e.isPending)}),queries:v.map(e=>_(e))}),r=e.filter(e=>e?.category===`smartphones`),i=e.filter(e=>e?.category===`laptops`),a=[...e.filter(e=>e?.category===`motorcycle`),...e.filter(e=>e?.category===`automotive`)],o=[...e.filter(e=>e?.category===`mens-watches`),...e.filter(e=>e?.category===`womens-watches`)];return{allProductsArray:e,hotSalesProductsArray:i,isError:t,isPending:n,recentlyViewedProductsArray:r,vehiclesProductsArray:a,watchesProductsArray:o}};export{w as b};